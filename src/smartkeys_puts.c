/**
 * smartkeys_puts.c - Put text using SmartKeys proportional font
 */

#include <msx.h>
#include <graphics.h>
#include <conio.h>

unsigned char smartkeys_font[] =
  {
   0x06,0x00,0x70,0x88,0x98,0xA8,0xC8,0x70,0x00, // 0x00 0
   0x06,0x00,0x20,0x60,0x20,0x20,0x20,0x70,0x00, // 0x01 1
   0x06,0x00,0x70,0x88,0x08,0x70,0x80,0xF8,0x00, // 0x02 2
   0x06,0x00,0xF8,0x08,0x30,0x08,0x88,0x70,0x00, // 0x03 3
   0x06,0x00,0x30,0x50,0x90,0xF8,0x10,0x10,0x00, // 0x04 4
   0x06,0x00,0xF8,0x80,0xF0,0x08,0x88,0x70,0x00, // 0x05 5
   0x06,0x00,0x78,0x80,0xF0,0x88,0x88,0x70,0x00, // 0x06 6
   0x06,0x00,0xF8,0x08,0x10,0x20,0x40,0x40,0x00, // 0x07 7
   0x06,0x00,0x70,0x88,0x70,0x88,0x88,0x70,0x00, // 0x08 8
   0x06,0x00,0x70,0x88,0x88,0x78,0x08,0xF0,0x00, // 0x09 9
   0x05,0x00,0x60,0x90,0x90,0xF0,0x90,0x90,0x00, // 0x0A A
   0x05,0x00,0xE0,0x90,0xE0,0x90,0x90,0xE0,0x00, // 0x0B B
   0x05,0x00,0x70,0x80,0x80,0x80,0x80,0x70,0x00, // 0x0C C
   0x05,0x00,0xE0,0x90,0x90,0x90,0x90,0xE0,0x00, // 0x0D D
   0x05,0x00,0xF0,0x80,0xE0,0x80,0x80,0xF0,0x00, // 0x0E E
   0x05,0x00,0xF0,0x80,0xE0,0x80,0x80,0x80,0x00, // 0x0F F
   0x05,0x00,0x60,0x90,0x80,0xB0,0x90,0x70,0x00, // 0x10 G
   0x05,0x00,0x90,0x90,0x90,0xF0,0x90,0x90,0x00, // 0x11 H
   0x02,0x00,0x80,0x80,0x80,0x80,0x80,0x80,0x00, // 0x12 I
   0x05,0x00,0x10,0x10,0x10,0x10,0x90,0x60,0x00, // 0x13 J
   0x05,0x00,0x80,0x90,0xA0,0xC0,0xA0,0x90,0x00, // 0x14 K
   0x05,0x00,0x80,0x80,0x80,0x80,0x80,0xF0,0x00, // 0x15 L
   0x06,0x00,0x88,0xD8,0xA8,0xA8,0x88,0x88,0x00, // 0x16 M
   0x05,0x00,0x90,0xD0,0xD0,0xB0,0x90,0x90,0x00, // 0x17 N
   0x05,0x00,0x60,0x90,0x90,0x90,0x90,0x60,0x00, // 0x18 O
   0x05,0x00,0xE0,0x90,0x90,0xE0,0x80,0x80,0x00, // 0x19 P
   0x05,0x00,0x60,0x90,0x90,0x90,0xB0,0x70,0x00, // 0x1A Q
   0x05,0x00,0xE0,0x90,0x90,0xE0,0xA0,0x90,0x00, // 0x1B R
   0x05,0x00,0x70,0x80,0x60,0x10,0x10,0xE0,0x00, // 0x1C S
   0x06,0x00,0xF8,0x20,0x20,0x20,0x20,0x20,0x00, // 0x1D T
   0x05,0x00,0x90,0x90,0x90,0x90,0x90,0x60,0x00, // 0x1E U
   0x06,0x00,0x88,0x88,0x88,0x50,0x50,0x20,0x00, // 0x1F V
   0x06,0x00,0x88,0x88,0xA8,0xA8,0xD8,0x88,0x00, // 0x20 W
   0x06,0x00,0x88,0x50,0x20,0x20,0x50,0x88,0x00, // 0x21 X
   0x06,0x00,0x88,0x88,0x50,0x20,0x20,0x20,0x00, // 0x22 Y
   0x05,0x00,0xF0,0x10,0x20,0x40,0x80,0xF0,0x00, // 0x23 Z
   0x05,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00, // 0x24 5px <SPACE>
   0x02,0x00,0x00,0x00,0x80,0x00,0x80,0x00,0x00, // 0x25 :
   0x05,0x00,0x10,0x10,0x20,0x20,0x40,0x40,0x00, // 0x26 /
   0x03,0x00,0x00,0x00,0x00,0x00,0x00,0x80,0x00, // 0x27 .
   0x06,0x50,0x50,0xF8,0x50,0xF8,0x50,0x50,0x00, // 0x28 #
   0x04,0x20,0x20,0x20,0x00,0x00,0x00,0x00,0x00, // 0x29 '
   0x04,0x00,0x00,0x00,0xE0,0x00,0x00,0x00,0x00, // 0x2A -
   0x06,0x70,0x88,0x10,0x20,0x20,0x00,0x20,0x00, // 0x2B ?
   0x08,0x00,0x00,0x00,0x00,0x00,0x00,0x03,0x33, // 0x2C WIFI1
   0x08,0x00,0x00,0x03,0x03,0x33,0x33,0x33,0x33, // 0x2D WIFI2
   0x08,0x30,0x30,0x30,0x30,0x30,0x30,0x30,0x30, // 0x2E WIFI3
   0x08,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00, // 0x2F 8px BLANK
   0x08,0x00,0x1C,0x08,0x08,0x08,0x08,0x1C,0x00, // 0x30 I
   0x08,0x00,0x3E,0x14,0x14,0x14,0x14,0x3E,0x00, // 0x31 II
   0x08,0x00,0x7F,0x2A,0x2A,0x2A,0x2A,0x7F,0x00, // 0x32 III
   0x08,0x00,0xF1,0x51,0x51,0x4A,0x4A,0xE4,0x00, // 0x33 IV
   0x08,0x00,0x22,0x22,0x22,0x14,0x14,0x08,0x00, // 0x34 V
   0x08,0x00,0x8F,0x8A,0x8A,0x52,0x52,0x27,0x00  // 0x35 VI
   
  };

/**
 * @brief Write string to VRAM using SmartKeys proportional font
 * @param x Column (0-255)
 * @param y Row (0-191)
 * @param c NULL terminated string to display
 */
void smartkeys_puts(unsigned char x, unsigned char y, const char *c)
{
  unsigned char oldx=x;
  
  // map ASCII to appropriate character
  while (*c != NULL)
    {
      unsigned short o;  // offset 
      unsigned char w;   // width
      unsigned char i;   // row index
      
      if (*c == ' ')
	o=0x24;
      else if (*c == ':')
	o=0x25;
      else if (*c == '/')
	o=0x26;
      else if (*c == '.')
	o=0x27;
      else if (*c == '#')
	o=0x28;
      else if (*c == '\'')
	o=0x29;
      else if (*c == '-')
	o=0x2A;
      else if (*c == '?')
	o=0x2B;
      else if (*c == 0x80)
	o=0x2C;
      else if (*c == 0x81)
	o=0x2D;
      else if (*c == 0x82)
	o=0x2E;
      else if (*c == 0xF1)
	o=0x30;
      else if (*c == 0xF2)
	o=0x31;
      else if (*c == 0xF3)
	o=0x32;
      else if (*c == 0xF4)
	o=0x33;
      else if (*c == 0xF5)
	o=0x34;
      else if (*c == 0xF6)
	o=0x35;
      else if (*c == '\n')
	{
	  x=oldx;
	  y += 8;
	  c++;
	  continue;
	}
      else if ((*c > 0x2f) && (*c < 0x40)) // 0-9
	o=(*c)-0x30; // 0 becomes 0x00
      else if ((*c > 0x3f) && (*c < 0x5b)) // A-Z
	o=(*c)-0x37; // A becomes 0x0A

      o *= 9; // Get offset for bitmap

      w = smartkeys_font[o++]; // First byte is width, also increment past it.

      for (i=0;i<8;i++)
	{
	  unsigned char b = smartkeys_font[o+i]; // the whole row byte
	  unsigned char j;  // column index.

	  for (j=0;j<w;j++)
	    {
	      if ((b & 0x80) == 0x80)
		pset(x+j,y+i);
	      
	      b <<= 1; // shift next bit to leftmost.
	    }

	}
      x += w; // Move X right by width pixels
      c++; // advance to next char;
    }
}
